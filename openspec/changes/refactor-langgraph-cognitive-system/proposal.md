# Refactor to LangGraph Cognitive Architecture

## Summary
将现有的桌面 AI 软件重构为 LangGraph 驱动的认知系统。从分散的组件架构转变为以**显式状态（State-first）**为核心、**能力节点（Capability Node）**为单元的认知图谱（Cognitive Graph）。

## Problem Statement
当前系统实现分散，组件间耦合度高。记忆、情感、MCP 服务等模块各自为政，难以支持长期运行、复杂任务的中断恢复以及深度的“人机回环”（Human-in-the-loop）协作。系统缺乏统一的认知轨迹，导致审计和调试困难。

## Intent (Goals)
构建一个**长期运行、可中断/可恢复、可审计、可被人类介入修正**的桌面人工智能基础设施。
核心转变：
1.  **显式状态（State-first）**：所有上下文和中间结果存储在统一的 Graph State 中。
2.  **节点化能力**：将推理、记忆检索、工具调用等封装为独立的图节点。
3.  **认知图谱**：支持失败重试、人工介入、回放的复杂控制流。

## Non-goals
1.  **非单纯技术迁移**：不仅仅是换一个库，而是重定义认知架构。
2.  **不追求全自动黑盒**：刻意保留 HITL 接口，不追求完全脱离人类的自主性。
3.  **不处理 UI 层的具体渲染细节**：只定义 HITL 协议和数据流，UI 实现由前端负责。

## Evolution Strategy
1.  **并行开发**：在现有系统旁构建新的 LangGraph 运行时的核心 State 和 Node。
2.  **逐步替换**：
    *   第一阶段：定义 State 和核心 Loop。
    *   第二阶段：迁移记忆和情感模块为节点。
    *   第三阶段：迁移 MCP 服务调用为工具节点。
    *   第四阶段：接入 HITL 界面，替换旧的交互逻辑。
3.  **State 契约优先**：优先稳定 State 定义，确保后续节点替换不破坏系统稳定性。
