## Context

当前HITL系统依赖LLM自主判断是否需要生成表单。HITL_INSTRUCTION中的指导较为保守，导致LLM倾向于使用普通对话而非结构化表单收集信息。这削弱了情感记忆系统的数据收集能力。

**当前触发条件**（过于保守）：
1. 需要收集用户偏好，且有明确的选项
2. 执行重要操作前需要确认
3. 存在多个选项需要选择
4. 用户明确要求选择

**问题分析**：
- LLM默认使用自然语言提问，很少主动使用表单
- 没有鼓励LLM在对话初期主动了解用户
- 缺乏与记忆系统联动的触发机制
- 情感状态没有被用于触发相关表单

## Goals / Non-Goals

**Goals:**
- 将HITL表单出现频率提升3-5倍
- 在对话早期阶段增加表单触发
- 通过表单收集更多高质量的结构化偏好数据
- 让表单触发更自然、不突兀

**Non-Goals:**
- 不改变HITL表单的渲染和提交流程
- 不改变表单数据的存储机制
- 不强制每轮对话都出现表单（避免打扰用户）

## Decisions

### Decision 1: 扩展触发场景分类

采用四类触发策略：

1. **主动询问策略 (Proactive Inquiry)**
   - 首次对话或新会话开始时
   - 检测到用户是新用户（记忆库较空）
   - 触发"了解您"类型的表单

2. **话题深化触发 (Topic Deepening)**
   - 用户提到某个领域但未详细说明偏好
   - 用户表达模糊的喜好（如"我喜欢运动"）
   - 触发该领域的详细偏好表单

3. **情感驱动触发 (Emotion-driven)**
   - 检测到积极情绪时，收集让用户开心的事物
   - 检测到消极情绪时，收集用户的困扰点
   - 与情感系统联动

4. **记忆补全触发 (Memory Gap Detection)**
   - 发现相关记忆缺失时主动询问
   - 用户行为暗示某偏好但记忆中没有记录
   - 填补用户画像空白

### Decision 2: 降低触发门槛

- 放宽"需要明确选项"的要求，LLM可以自行设计合理选项
- 鼓励LLM更积极地使用表单收集信息

### Decision 3: 通过Prompt工程实现

所有触发逻辑通过修改HITL_INSTRUCTION实现，不增加后端代码复杂度。让LLM具备更强的主动收集意识。

**Alternatives considered:**
- 后端规则引擎触发：过于僵硬，难以适应自然对话流
- 机器学习模型预测：复杂度高，收益不明确
- **选择Prompt工程**：实现简单，灵活性高，可快速迭代

## Risks / Trade-offs

| Risk | Impact | Mitigation |
|------|--------|------------|
| LLM生成的选项质量不稳定 | Medium | 提供更多示例，引导生成合理选项 |
| 增加prompt长度影响性能 | Low | 精简指令，使用结构化格式 |

## Open Questions

1. 是否需要在前端增加"暂时不想填写表单"的全局设置？
